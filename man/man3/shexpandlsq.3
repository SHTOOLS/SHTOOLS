.\" Automatically generated by Pandoc 3.1.12.3
.\"
.TH "shexpandlsq" "1" "2024\-04\-06" "Fortran 95" "SHTOOLS 4.12"
.SH SHExpandLSQ
Determine the spherical harmonic coefficients of an irregularly sampled
function using a (weighted) least squares inversion.
.SH Usage
call SHExpandLSQ (\f[CR]cilm\f[R], \f[CR]d\f[R], \f[CR]lat\f[R],
\f[CR]lon\f[R], \f[CR]nmax\f[R], \f[CR]lmax\f[R], \f[CR]norm\f[R],
\f[CR]chi2\f[R], \f[CR]csphase\f[R], \f[CR]weights\f[R], \f[CR]g\f[R],
\f[CR]exitstatus\f[R])
.SH Parameters
.TP
\f[CR]cilm\f[R] : output, real(dp), dimension (2, \f[CR]lmax\f[R]+1, \f[CR]lmax\f[R]+1)
The real spherical harmonic coefficients of the function.
The coefficients \f[CR]C1lm\f[R] and \f[CR]C2lm\f[R] refer to the cosine
(\f[CR]Clm\f[R]) and sine (\f[CR]Slm\f[R]) coefficients, respectively,
with \f[CR]Clm=cilm(1,l+1,m+1)\f[R] and \f[CR]Slm=cilm(2,l+1,m+1)\f[R].
.TP
\f[CR]d\f[R] : input, real(dp), dimension (\f[CR]nmax\f[R])
The value of the function at the coordinates (\f[CR]lat\f[R],
\f[CR]lon\f[R]).
.TP
\f[CR]lat\f[R] : input, real(dp), dimension (\f[CR]nmax\f[R])
The latitude in degrees corresponding to the value in \f[CR]d\f[R].
.TP
\f[CR]lon\f[R] : input, real(dp), dimension (\f[CR]nmax\f[R])
The longitude in degrees corresponding to the value in \f[CR]d\f[R].
.TP
\f[CR]nmax\f[R] : input, integer(int32)
The number of data points.
.TP
\f[CR]lmax\f[R] : input, integer(int32)
The maximum spherical harmonic degree of the output coefficients
\f[CR]cilm\f[R].
.TP
\f[CR]norm\f[R] : input, optional, integer(int32), default = 1
1 (default) = Geodesy 4\-pi normalized harmonics; 2 = Schmidt
semi\-normalized harmonics; 3 = unnormalized harmonics; 4 = orthonormal
harmonics.
.TP
\f[CR]chi2\f[R] : output, optional, real(dp)
The residual (weighted) sum of squares misfit.
.TP
\f[CR]csphase\f[R] : input, optional, integer(int32), default = 1
1 (default) = do not apply the Condon\-Shortley phase factor to the
associated Legendre functions; \-1 = append the Condon\-Shortley phase
factor of (\-1)\[ha]m to the associated Legendre functions.
.TP
\f[CR]weights\f[R] : input, real(dp), dimension (\f[CR]nmax\f[R])
The weights to be applied in a weighted least squares inversion.
.TP
\f[CR]g\f[R] : input, real(dp), dimension (\f[CR]nmax\f[R], \f[CR](lmax+1)**2\f[R])
The data kernel matrix G that is used when performing the least squares
inversion.
.TP
\f[CR]exitstatus\f[R] : output, optional, integer(int32)
If present, instead of executing a STOP when an error is encountered,
the variable exitstatus will be returned describing the error.
0 = No errors; 1 = Improper dimensions of input array; 2 = Improper
bounds for input variable; 3 = Error allocating memory; 4 = File IO
error.
.SH Description
\f[CR]SHExpandLSQ\f[R] will determine the spherical harmonic
coefficients of an irregularly sampled function using a least squares
inversion.
When the number of data points is greater or equal to the number of
spherical harmonic coefficients (i.e., \f[CR]nmax>=(lmax+1)**2\f[R]),
the solution of the overdetermined system will be determined.
If there are more coefficients than data points, then the solution of
the underdetermined system that minimizes the solution norm will be
determined.
The inversions are performed using the LAPACK routine DGELS.
.PP
A weighted least squares inversion will be performed if the optional
vector \f[CR]weights\f[R] is specified.
The weights should be set equal to the inverse of the data variance, and
it is assumed explicitly that each measurement is statistically
independent (i.e., the weighting matrix is diagonal).
The weighted least squares inversion must be overdetermined, and the
inversion is performed using the LAPACK routine DGELS after scaling the
data vector and inversion matrix.
.PP
The employed spherical harmonic normalization and Condon\-Shortley phase
convention can be set by the optional arguments \f[CR]norm\f[R] and
\f[CR]csphase\f[R]; if not set, the default is to use geodesy 4\-pi
normalized harmonics that exclude the Condon\-Shortley phase of
(\-1)\[ha]m.
If the subroutine is to be called several times using the same lat and
lon coordinates, the data kernel matrix G can be precomputed using the
routine LSQ_G.
.SH See also
lsq_g, makegriddh, shexpanddh, makegriddhc, shexpanddhc, makegridglq,
shexpandglq, makegridglqc, shexpandglqc, dgels(1)
